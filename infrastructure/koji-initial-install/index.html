



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    

      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://opensciencegrid.github.io/technology/infrastructure/koji-initial-install/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-0.17.5, mkdocs-material-2.9.4">
    
    
      
        <title>Koji Initial Install - OSG Technology Area</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#notes-on-koji-initial-install" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://opensciencegrid.github.io/technology/" title="OSG Technology Area" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                OSG Technology Area
              </span>
              <span class="md-header-nav__topic">
                Koji Initial Install
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/opensciencegrid/technology/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://opensciencegrid.github.io/technology/" title="OSG Technology Area" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    OSG Technology Area
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/opensciencegrid/technology/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Software
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Software
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      Packaging
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        Packaging
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../software/rpm-development-guide/" title="RPM Development Guide" class="md-nav__link">
      RPM Development Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../software/osg-build-tools/" title="OSG Build Tools" class="md-nav__link">
      OSG Build Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../software/quilt/" title="Using Quilt" class="md-nav__link">
      Using Quilt
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../software/upcoming-to-main/" title="Upcoming to Main" class="md-nav__link">
      Upcoming to Main
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../software/koji-workflow/" title="Koji Workflow" class="md-nav__link">
      Koji Workflow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../software/create-vo-client/" title="Creating the VO Client Package" class="md-nav__link">
      Creating the VO Client Package
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../software/repository-management/" title="Repository Management" class="md-nav__link">
      Repository Management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../software/globus-mass-update-procedure/" title="Globus Mass Update Procedure" class="md-nav__link">
      Globus Mass Update Procedure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../software/resurrecting-epel-packages/" title="Resurrecting Epel Packages" class="md-nav__link">
      Resurrecting Epel Packages
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../software/koji-mass-rebuilds/" title="Koji Mass Rebuilds" class="md-nav__link">
      Koji Mass Rebuilds
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Development
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../software/development-process/" title="Development Process" class="md-nav__link">
      Development Process
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../software/git-software-development/" title="Git Software Development Process" class="md-nav__link">
      Git Software Development Process
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../software/ce-test-scaling/" title="CE Scale Testing" class="md-nav__link">
      CE Scale Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../software/ipv6-testing/" title="IPv6 Testing" class="md-nav__link">
      IPv6 Testing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../policy/software-support/" title="Software Support" class="md-nav__link">
      Software Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../software/effort-tracking/" title="Effort Tracking" class="md-nav__link">
      Effort Tracking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../software/release-planning/" title="Release Planning" class="md-nav__link">
      Release Planning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../software/new-team-member/" title="New Team Member" class="md-nav__link">
      New Team Member
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Release
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Release
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../release/cut-sw-release/" title="How to Cut a Release" class="md-nav__link">
      How to Cut a Release
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../release/cut-data-release/" title="How to Cut a Data Release" class="md-nav__link">
      How to Cut a Data Release
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../release/release-policy/" title="Release Policy" class="md-nav__link">
      Release Policy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../release/new-release-series/" title="New Release Series" class="md-nav__link">
      New Release Series
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../release/old-release-removal/" title="Old Release Series Removal" class="md-nav__link">
      Old Release Series Removal
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../release/itb-testing/" title="ITB Prerelease Testing" class="md-nav__link">
      ITB Prerelease Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../release/empty-pkgs/" title="Empty Packages" class="md-nav__link">
      Empty Packages
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../release/acceptance-testing/" title="Acceptance Testing" class="md-nav__link">
      Acceptance Testing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Policy
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Policy
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../policy/service-migrations-spring-2018/" title="Service Migrations - Spring 2018" class="md-nav__link">
      Service Migrations - Spring 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../policy/gums-retire/" title="GUMS Retirement" class="md-nav__link">
      GUMS Retirement
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../policy/bestman2-retire/" title="BeStMan2 Retirement" class="md-nav__link">
      BeStMan2 Retirement
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../policy/voms-admin-retire/" title="VOMS Admin Retirement" class="md-nav__link">
      VOMS Admin Retirement
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../policy/release-series/" title="Release Series Support" class="md-nav__link">
      Release Series Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../policy/globus-toolkit/" title="Globus Toolkit Support" class="md-nav__link">
      Globus Toolkit Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../policy/external-oasis-repos/" title="OASIS Repository Mirroring" class="md-nav__link">
      OASIS Repository Mirroring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../policy/flexible-release-model/" title="Flexible Release Model" class="md-nav__link">
      Flexible Release Model
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Infrastructure
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Infrastructure
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../koji-restore-recipe/" title="Koji Restore Recipe" class="md-nav__link">
      Koji Restore Recipe
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../koji-hub-setup/" title="Koji-Hub Setup" class="md-nav__link">
      Koji-Hub Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../koji-inf-overview/" title="Koji Infrastructure Overview" class="md-nav__link">
      Koji Infrastructure Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../koji-policy-writing/" title="Koji Policy Writing" class="md-nav__link">
      Koji Policy Writing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../koji-user-management/" title="Koji User Management" class="md-nav__link">
      Koji User Management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../madison-itb/" title="Madison ITB" class="md-nav__link">
      Madison ITB
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/writing-documentation/" title="Writing Documentation" class="md-nav__link">
      Writing Documentation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/reviewing-documentation/" title="Reviewing Documentation" class="md-nav__link">
      Reviewing Documentation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/style-guide/" title="Markdown Style Guide" class="md-nav__link">
      Markdown Style Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/new-doc-area/" title="Creating a New Area" class="md-nav__link">
      Creating a New Area
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      Historical Information
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Historical Information
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Koji Initial Install
      </label>
    
    <a href="./" title="Koji Initial Install" class="md-nav__link md-nav__link--active">
      Koji Initial Install
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#machine-setup" title="Machine setup" class="md-nav__link">
    Machine setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#packages-to-install" title="Packages to install" class="md-nav__link">
    Packages to install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filesystems" title="Filesystems" class="md-nav__link">
    Filesystems
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-note-on-filesystem-space" title="A note on filesystem space" class="md-nav__link">
    A note on filesystem space
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication" title="Authentication" class="md-nav__link">
    Authentication
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-proxy-certs" title="Using proxy certs" class="md-nav__link">
    Using proxy certs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postgres-database" title="Postgres Database" class="md-nav__link">
    Postgres Database
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-postgresql-and-populate-schema" title="Setup PostgreSQL and populate schema:" class="md-nav__link">
    Setup PostgreSQL and populate schema:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#koji-hub" title="Koji-Hub" class="md-nav__link">
    Koji-Hub
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#etchttpdconfhttpdconf" title="/etc/httpd/conf/httpd.conf:" class="md-nav__link">
    /etc/httpd/conf/httpd.conf:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etckoji-hubhubconf" title="/etc/koji-hub/hub.conf:" class="md-nav__link">
    /etc/koji-hub/hub.conf:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etchttpdconfdkojihubconf" title="/etc/httpd/conf.d/kojihub.conf:" class="md-nav__link">
    /etc/httpd/conf.d/kojihub.conf:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etchttpdconfdsslconf" title="/etc/httpd/conf.d/ssl.conf:" class="md-nav__link">
    /etc/httpd/conf.d/ssl.conf:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-a-real-admin-user" title="Adding a real admin user" class="md-nav__link">
    Adding a real admin user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#koji-filesystem" title="Koji filesystem" class="md-nav__link">
    Koji filesystem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#accounts-for-kojira-and-kojid" title="Accounts for kojira and kojid" class="md-nav__link">
    Accounts for kojira and kojid
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#koji-web-kojid" title="Koji-Web, Kojid" class="md-nav__link">
    Koji-Web, Kojid
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ssl-certs" title="SSL certs" class="md-nav__link">
    SSL certs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-koji-builder-host-to-database" title="Adding koji-builder host to database" class="md-nav__link">
    Adding koji-builder host to database
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-kojid" title="Start kojid" class="md-nav__link">
    Start kojid
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kojira" title="Kojira" class="md-nav__link">
    Kojira
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Historical Transitions
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Historical Transitions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../projects/sha2-support/" title="SHA-2 Support" class="md-nav__link">
      SHA-2 Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documentation/markdown-migration/" title="Migrating Documents to Markdown" class="md-nav__link">
      Migrating Documents to Markdown
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Meetings
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Meetings
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20181203/" title="December 3, 2018" class="md-nav__link">
      December 3, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20181126/" title="November 26, 2018" class="md-nav__link">
      November 26, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20181119/" title="November 19, 2018" class="md-nav__link">
      November 19, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20181112/" title="November 12, 2018" class="md-nav__link">
      November 12, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20181105/" title="November 5, 2018" class="md-nav__link">
      November 5, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20181029/" title="October 29, 2018" class="md-nav__link">
      October 29, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20181022/" title="October 22, 2018" class="md-nav__link">
      October 22, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20181015/" title="October 15, 2018" class="md-nav__link">
      October 15, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20181008/" title="October 8, 2018" class="md-nav__link">
      October 8, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20181001/" title="October 1, 2018" class="md-nav__link">
      October 1, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180924/" title="September 24, 2018" class="md-nav__link">
      September 24, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180917/" title="September 17, 2018" class="md-nav__link">
      September 17, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180910/" title="September 10, 2018" class="md-nav__link">
      September 10, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180827/" title="August 27, 2018" class="md-nav__link">
      August 27, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180820/" title="August 20, 2018" class="md-nav__link">
      August 20, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180813/" title="August 13, 2018" class="md-nav__link">
      August 13, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180806/" title="August 6, 2018" class="md-nav__link">
      August 6, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180730/" title="July 30, 2018" class="md-nav__link">
      July 30, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180723/" title="July 23, 2018" class="md-nav__link">
      July 23, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180716/" title="July 16, 2018" class="md-nav__link">
      July 16, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180702/" title="July 2, 2018" class="md-nav__link">
      July 2, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180625/" title="June 25, 2018" class="md-nav__link">
      June 25, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180618/" title="June 18, 2018" class="md-nav__link">
      June 18, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180611/" title="June 11, 2018" class="md-nav__link">
      June 11, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180604/" title="June 4, 2018" class="md-nav__link">
      June 4, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180529/" title="May 29, 2018" class="md-nav__link">
      May 29, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180514/" title="May 14, 2018" class="md-nav__link">
      May 14, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180507/" title="May 7, 2018" class="md-nav__link">
      May 7, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180430/" title="April 30, 2018" class="md-nav__link">
      April 30, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180423/" title="April 23, 2018" class="md-nav__link">
      April 23, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180416/" title="April 16, 2018" class="md-nav__link">
      April 16, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180409/" title="April 9, 2018" class="md-nav__link">
      April 9, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180402/" title="April 2, 2018" class="md-nav__link">
      April 2, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180312/" title="March 12, 2018" class="md-nav__link">
      March 12, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180305/" title="March 5, 2018" class="md-nav__link">
      March 5, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180226/" title="February 26, 2018" class="md-nav__link">
      February 26, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180219/" title="February 19, 2018" class="md-nav__link">
      February 19, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180212/" title="February 12, 2018" class="md-nav__link">
      February 12, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180205/" title="February 5, 2018" class="md-nav__link">
      February 5, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180129/" title="January 29, 2018" class="md-nav__link">
      January 29, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180122/" title="January 22, 2018" class="md-nav__link">
      January 22, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180108/" title="January 8, 2018" class="md-nav__link">
      January 8, 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../meetings/2018/TechArea20180102/" title="January 2, 2018" class="md-nav__link">
      January 2, 2018
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#machine-setup" title="Machine setup" class="md-nav__link">
    Machine setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#packages-to-install" title="Packages to install" class="md-nav__link">
    Packages to install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filesystems" title="Filesystems" class="md-nav__link">
    Filesystems
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-note-on-filesystem-space" title="A note on filesystem space" class="md-nav__link">
    A note on filesystem space
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication" title="Authentication" class="md-nav__link">
    Authentication
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-proxy-certs" title="Using proxy certs" class="md-nav__link">
    Using proxy certs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postgres-database" title="Postgres Database" class="md-nav__link">
    Postgres Database
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-postgresql-and-populate-schema" title="Setup PostgreSQL and populate schema:" class="md-nav__link">
    Setup PostgreSQL and populate schema:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#koji-hub" title="Koji-Hub" class="md-nav__link">
    Koji-Hub
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#etchttpdconfhttpdconf" title="/etc/httpd/conf/httpd.conf:" class="md-nav__link">
    /etc/httpd/conf/httpd.conf:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etckoji-hubhubconf" title="/etc/koji-hub/hub.conf:" class="md-nav__link">
    /etc/koji-hub/hub.conf:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etchttpdconfdkojihubconf" title="/etc/httpd/conf.d/kojihub.conf:" class="md-nav__link">
    /etc/httpd/conf.d/kojihub.conf:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etchttpdconfdsslconf" title="/etc/httpd/conf.d/ssl.conf:" class="md-nav__link">
    /etc/httpd/conf.d/ssl.conf:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-a-real-admin-user" title="Adding a real admin user" class="md-nav__link">
    Adding a real admin user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#koji-filesystem" title="Koji filesystem" class="md-nav__link">
    Koji filesystem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#accounts-for-kojira-and-kojid" title="Accounts for kojira and kojid" class="md-nav__link">
    Accounts for kojira and kojid
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#koji-web-kojid" title="Koji-Web, Kojid" class="md-nav__link">
    Koji-Web, Kojid
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ssl-certs" title="SSL certs" class="md-nav__link">
    SSL certs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-koji-builder-host-to-database" title="Adding koji-builder host to database" class="md-nav__link">
    Adding koji-builder host to database
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-kojid" title="Start kojid" class="md-nav__link">
    Start kojid
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kojira" title="Kojira" class="md-nav__link">
    Kojira
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/opensciencegrid/technology/edit/master/docs/infrastructure/koji-initial-install.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="notes-on-koji-initial-install">Notes on Koji initial install<a class="headerlink" href="#notes-on-koji-initial-install" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This document was written for the original install of koji/koji-hub version
1.6 to <code>koji-hub.batlab.org</code>.  The document is kept for historical
purposes, as this setup is no longer accurate with newer versions of Koji,
machine moves and renames, cert authority changes, etc.</p>
</div>
<h2 id="machine-setup">Machine setup<a class="headerlink" href="#machine-setup" title="Permanent link">&para;</a></h2>
<p>koji is run on <code>koji-hub.batlab.org</code>; right now a single machine was used for the hub (koji-hub), the web frontend (koji-web), repo generation (kojira), and el5 building (kojid). A second machine, <code>kojibuilder1.batlab.org</code> was used for el6 building.</p>
<p>As instructions for setting up the machine, I'm just going to take the Fedora guide at <a href="http://fedoraproject.org/wiki/Koji/ServerHowTo">http://fedoraproject.org/wiki/Koji/ServerHowTo</a>, and add modifications / comments to suit our setup.</p>
<p>Sections taken from the Fedora guide will be between dividers like this:</p>
<hr />
<blockquote>
<ul>
<li>For an overview of yum, mock, Koji (and all its subcomponents), mash, and how they all work together, see the excellent slides put together by Steve Traylen at CERN <a href="http://indico.cern.ch/event/55091">http://indico.cern.ch/event/55091</a></li>
</ul>
</blockquote>
<hr />
<h3 id="packages-to-install">Packages to install<a class="headerlink" href="#packages-to-install" title="Permanent link">&para;</a></h3>
<hr />
<blockquote>
<p><strong>On the server (koji-hub/koji-web)</strong></p>
<ul>
<li>httpd</li>
<li>mod_ssl</li>
<li>postgresql-server</li>
<li>mod_python (&gt;= 3.3.1 for Kerberos authentication)</li>
</ul>
<p><strong>On the builder (koji-builder)</strong></p>
<ul>
<li>mock</li>
<li>setarch (for some archs you'll require a patched version)</li>
<li>rpm-build</li>
<li>createrepo</li>
</ul>
</blockquote>
<hr />
<p>We used one machine for both these roles, so all of the above had to be installed.</p>
<p>The koji packages to install are:</p>
<ul>
<li>koji-hub</li>
<li>koji-web</li>
<li>koji-builder</li>
<li>koji-utils</li>
</ul>
<h3 id="filesystems">Filesystems<a class="headerlink" href="#filesystems" title="Permanent link">&para;</a></h3>
<hr />
<blockquote>
<h4 id="a-note-on-filesystem-space">A note on filesystem space<a class="headerlink" href="#a-note-on-filesystem-space" title="Permanent link">&para;</a></h4>
<p>Koji will consume copious amounts of disk space under the primary KojiDir directory (as set in the kojihub.conf file).</p>
</blockquote>
<hr />
<p>This is <code>/mnt/koji</code> by default. Koji keeps <em>all RPMs built</em> in here so a complete history is kept. In addition, repositories are kept here. A repository is just a set of text files, but since a new one is generated for every build, the space will add up. Koji does clean up the repositories once they get old enough. For <code>koji-hub.batlab.org</code>, we allocated a 120G partition for <code>/mnt/koji</code>.</p>
<hr />
<blockquote>
<p>However, as koji makes use of mock on the backend to actually create build roots and perform the builds in those build roots, it might come to a surprise to users that a running koji server will consume large amounts of disk space under /var/lib/mock and /var/cache/mock as well.</p>
</blockquote>
<hr />
<p><code>kojid</code> (the builder daemon) will refuse to start a build if it does not have sufficient space under <code>/var/lib/mock</code>. By default, this is an 8G surplus, but we lowered it to 4G for <code>koji-hub.batlab.org</code>. The build roots will be wiped after successful builds, but the build roots for failed builds will be kept around for 2 weeks (?); as a result, disk usage of <code>/var/lib/mock</code> can swing wildly. For <code>koji-hub.batlab.org</code>, we have allocated 35G for <code>/var/lib/mock</code>. <code>/var/cache/mock</code> doesn't use up that much space, so we didn't make a separate partition for it, it just uses what's under <code>/</code>.</p>
<h3 id="authentication">Authentication<a class="headerlink" href="#authentication" title="Permanent link">&para;</a></h3>
<p>Most of the "Koji Authentication Selection" section can be skipped. We got our certs from DigiCert. <strong>Note</strong> that certs are sensitive to line ending issues -- you may have to run <code>dos2unix</code> on them before they would work.</p>
<p>We have 3 certs, with the following subjects:</p>
<ul>
<li><code>/DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=koji-hub.batlab.org</code> (for koji-hub, koji-web, and kojid)</li>
<li><code>/DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=kojira/koji-hub.batlab.org</code> (for kojira)</li>
<li><code>/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=Services/CN=kojibuilder1.batlab.org</code> (for kojid on kojibuilder1)</li>
</ul>
<p>kojid needed a different cert than kojira because the two would connect to koji-hub at the same time and log each other off.</p>
<p>Copies of the certs exist in AFS at <code>/p/condor/home/certificates/koji-hub.batlab.org/</code> and <code>/p/condor/home/certificates/kojibuilder1.batlab.org/</code></p>
<p>Clients connecting to koji-hub need a file containing the CA certs; this is just a concatenation of the DigiCert Grid Root CA and the DigiCert Grid CA-1 certs, which can be obtained from DigiCert's website (get PEM format). We have a <code>digicert-chain.crt</code> in <code>/etc/pki/tls/certs/digicert-chain.crt</code> on <code>koji-hub</code></p>
<p>We made a <code>kojiadmin</code> user, but we didn't make a cert for it so we just used user/pass authentication until we set up our own accounts and then disabled <code>kojiadmin</code>.</p>
<h4 id="using-proxy-certs">Using proxy certs<a class="headerlink" href="#using-proxy-certs" title="Permanent link">&para;</a></h4>
<p><code>/etc/sysconfig/httpd</code> needed to be changed to include the following lines:</p>
<div class="codehilite"><pre><span></span><span class="nv">OPENSSL_ALLOW_PROXY</span><span class="o">=</span><span class="m">1</span>
<span class="nv">OPENSSL_ALLOW_PROXY_CERTS</span><span class="o">=</span><span class="m">1</span>

<span class="nb">export</span> OPENSSL_ALLOW_PROXY
<span class="nb">export</span> OPENSSL_ALLOW_PROXY_CERTS
</pre></div>


<p>The user must use RFC proxies and must have a version of the koji client of 1.6.0-6.osg or newer.</p>
<h3 id="postgres-database">Postgres Database<a class="headerlink" href="#postgres-database" title="Permanent link">&para;</a></h3>
<ul>
<li>Install postgres:<br />
<code>[root@koji-hub]# yum install postgresql-server</code></li>
<li>Init the db:<br />
<code>[root@koji-hub]# su - postgres -c "PGDATA=/var/lib/pgsql/data" initdb</code></li>
<li>Start the db:<br />
<code>[root@koji-hub]# service postgresql start</code></li>
<li>Make a koji account:<br />
<code>[root@koji-hub]# useradd koji; passwd -d koji</code></li>
</ul>
<hr />
<!-- I'd love to highlight the quoted stuff but the ``` is broken within blockquotes -->

<blockquote>
<h4 id="setup-postgresql-and-populate-schema">Setup PostgreSQL and populate schema:<a class="headerlink" href="#setup-postgresql-and-populate-schema" title="Permanent link">&para;</a></h4>
<p>The following commands will create the <code>koji</code> user within PostgreSQL and will then create the koji database using the schema within the <code>/usr/share/doc/koji*/docs/schema.sql</code> directory</p>
<div class="codehilite"><pre><span></span>root@localhost$ su - postgres
postgres@localhost$ createuser koji
Shall the new role be a superuser? (y/n) n
Shall the new role be allowed to create databases? (y/n) n
Shall the new role be allowed to create more new roles? (y/n) n
postgres@localhost$ createdb -O koji koji
postgres@localhost$ logout
root@localhost$ su - koji
koji@localhost$ psql koji koji &lt; /usr/share/doc/koji*/docs/schema.sql
koji@localhost$ exit
</pre></div>


<p><strong>NOTE:</strong> When issuing the command to import the psql schema into the new database it is important to ensure that the directory path <code>/usr/share/doc/koji*/docs/schema.sql</code> remains intact and is not resolved to a specific version of koji. In test it was discovered that when the path is resolved to a specific version of koji then not all of the tables were created correctly.</p>
</blockquote>
<hr />
<p>To authorize the koji-web and koji-hub resources, make the following additions to <code>/var/lib/pgsql/data/pg_hba.conf</code> (IP addresses will vary):</p>
<div class="codehilite"><pre><span></span># access for koji
host    koji        postgres    127.0.0.1/32          trust
host    koji        koji        127.0.0.1/32          trust
host    koji        koji        128.104.100.41/32     trust
host    koji        koji        ::1/128               trust
</pre></div>


<p>Next, we'll need a koji admin user to run some commands. We'll need to add it to the database manually. Once again, we used user/pass authentication for the kojiadmin user until we disabled it. All database commands should be done as the <code>koji</code> user:</p>
<div class="codehilite"><pre><span></span><span class="gp">[root@koji-hub]#</span> sudo -u koji psql
</pre></div>


<div class="codehilite"><pre><span></span><span class="gp">koji=&gt;</span>  <span class="k">insert</span> <span class="k">into</span> <span class="n">users</span> <span class="p">(</span><span class="k">name</span><span class="p">,</span> <span class="k">password</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">usertype</span><span class="p">)</span> <span class="k">values</span>
          <span class="p">(</span><span class="s1">&#39;kojiadmin&#39;</span><span class="p">,</span> <span class="s1">&#39;some-throwaway-admin-password-in-plain-text&#39;</span><span class="p">,</span> <span class="mf">0</span><span class="p">,</span> <span class="mf">0</span><span class="p">);</span>
<span class="gp">koji=&gt;</span>  <span class="k">insert</span> <span class="k">into</span> <span class="n">user_perms</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">perm_id</span><span class="p">,</span> <span class="n">creator_id</span><span class="p">)</span> <span class="k">values</span>
          <span class="p">((</span><span class="k">select</span> <span class="n">id</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="k">name</span><span class="o">=</span><span class="s1">&#39;kojiadmin&#39;</span><span class="p">),</span> <span class="mf">1</span><span class="p">,</span>
           <span class="p">(</span><span class="k">select</span> <span class="n">id</span> <span class="k">from</span> <span class="n">users</span> <span class="k">where</span> <span class="k">name</span><span class="o">=</span><span class="s1">&#39;kojiadmin&#39;</span><span class="p">));</span>
</pre></div>


<h3 id="koji-hub">Koji-Hub<a class="headerlink" href="#koji-hub" title="Permanent link">&para;</a></h3>
<hr />
<blockquote>
<p>Koji-hub is the center of all Koji operations. It is an XML-RPC server running under mod_python in Apache. koji-hub is passive in that it only receives XML-RPC calls and relies upon the build daemons and other components to initiate communication. Koji-hub is the only component that has direct access to the database and is one of the two components that have write access to the file system.</p>
</blockquote>
<hr />
<p>Config files we care about:</p>
<ul>
<li><code>/etc/httpd/conf/httpd.conf</code></li>
<li><code>/etc/httpd/conf.d/kojihub.conf</code></li>
<li><code>/etc/httpd/conf.d/ssl.conf</code></li>
<li><code>/etc/koji-hub/hub.conf</code></li>
</ul>
<p>Install the necessary packages.</p>
<div class="codehilite"><pre><span></span><span class="gp">[root@koji-hub]#</span> yum install koji-hub httpd mod_ssl mod_python
</pre></div>


<hr />
<blockquote>
<h4 id="etchttpdconfhttpdconf">/etc/httpd/conf/httpd.conf:<a class="headerlink" href="#etchttpdconfhttpdconf" title="Permanent link">&para;</a></h4>
<p>The apache web server has two places that it sets maximum requests a server will handle before the server restarts. The xmlrpc interface in kojihub is a python application, and mod_python can sometimes grow outrageously large when it doesn't reap memory often enough. As a result, it is strongly recommended that you set both instances of MaxRequestsPerChild in <code>httpd.conf</code> to something reasonable in order to prevent the server from becoming overloaded and crashing (at 100 the <code>httpd</code> processes will grow to about 75MB resident set size before respawning).</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;IfModule</span> <span class="err">prefork.c</span><span class="nt">&gt;</span>
...
MaxRequestsPerChild  100
<span class="nt">&lt;/IfModule&gt;</span>
<span class="nt">&lt;IfModule</span> <span class="err">worker.c</span><span class="nt">&gt;</span>
...
MaxRequestsPerChild  100
<span class="nt">&lt;/IfModule&gt;</span>
</pre></div>


<h4 id="etckoji-hubhubconf">/etc/koji-hub/hub.conf:<a class="headerlink" href="#etckoji-hubhubconf" title="Permanent link">&para;</a></h4>
<p>This file contains the configuration information for the hub. You will need to edit this configuration to point Koji Hub to the database you are using and to setup Koji Hub to utilize the authentication scheme you selected in the beginning.</p>
</blockquote>
<hr />
<p>We made multiple changes to this config file.</p>
<p>Notable changes:</p>
<ul>
<li>We turned off <code>LoginCreatesUser</code></li>
<li><code>KojiWebURL</code> is <a href="http://koji-hub.batlab.org/koji">http://koji-hub.batlab.org/koji</a></li>
<li><code>PluginPath</code> is <code>/usr/lib/koji-hub-plugins</code></li>
<li><code>Plugins = sign</code> since there is an RPM signing plugin (package name: <code>koji-plugin-sign</code>) that we use</li>
</ul>
<p>Other notes:</p>
<ul>
<li>Should not be world-readable</li>
<li>Must be readable by the <code>apache</code> user though</li>
</ul>
<p>Finally, there is a <code>[policy]</code> section for controlling ACLs. The contents of that are described later in this document.</p>
<hr />
<blockquote>
<h4 id="etchttpdconfdkojihubconf">/etc/httpd/conf.d/kojihub.conf:<a class="headerlink" href="#etchttpdconfdkojihubconf" title="Permanent link">&para;</a></h4>
<p>If using SSL auth, uncomment these lines for kojiweb to allow logins.</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;Location</span> <span class="err">/kojihub</span><span class="nt">&gt;</span>
SSLOptions +StdEnvVars
<span class="nt">&lt;/Location&gt;</span>
</pre></div>


</blockquote>
<hr />
<p>This is actually outdated information, useful for Koji &lt; 1.4.0. Instead, we add the following:</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;Location</span> <span class="s">/kojihub/ssllogin</span><span class="nt">&gt;</span>
        <span class="nb">SSLVerifyClient</span> require
        <span class="nb">SSLVerifyDepth</span>  <span class="m">10</span>
        <span class="nb">SSLOptions</span> +StdEnvVars
<span class="nt">&lt;/Location&gt;</span>
</pre></div>


<hr />
<blockquote>
<h4 id="etchttpdconfdsslconf">/etc/httpd/conf.d/ssl.conf:<a class="headerlink" href="#etchttpdconfdsslconf" title="Permanent link">&para;</a></h4>
<p>If using SSL you will also need to add the needed SSL options for apache. These options should point to where the certificates are located on the hub.</p>
</blockquote>
<hr />
<p>These are the config lines we use:</p>
<div class="codehilite"><pre><span></span><span class="c">## The host cert for koji-hub</span>
<span class="nb">SSLCertificateFile</span> <span class="sx">/etc/pki/tls/certs/digicert_hostcert.crt</span>

<span class="c">## The private key for koji-hub</span>
<span class="nb">SSLCertificateKeyFile</span> <span class="sx">/etc/pki/tls/private/digicert_hostkey.key</span>

<span class="c">## The concatenation of the DigiCert CA certs we made above.</span>
<span class="nb">SSLCertificateChainFile</span> <span class="sx">/etc/pki/tls/certs/digicert-chain.crt</span>

<span class="c">## All the CA certs on the system.</span>
<span class="nb">SSLCACertificateFile</span> <span class="sx">/etc/pki/tls/certs/ca-bundle.crt</span>

<span class="nb">SSLVerifyClient</span> require
<span class="nb">SSLVerifyDepth</span>  <span class="m">10</span>
</pre></div>


<p>Restart <code>httpd</code> after doing this.</p>
<h4 id="adding-a-real-admin-user">Adding a real admin user<a class="headerlink" href="#adding-a-real-admin-user" title="Permanent link">&para;</a></h4>
<p>At this point, SSL should be set up on Koji Hub. Create an account for yourself (your CN) and give yourself the admin bit:</p>
<div class="codehilite"><pre><span></span><span class="gp">[kojiadmin@koji-hub]$</span> koji add-user <span class="s1">&#39;Your Name 123456&#39;</span>
<span class="gp">[kojiadmin@koji-hub]$</span> koji grant-permission admin <span class="s1">&#39;Your Name 123456&#39;</span>
</pre></div>


<p><strong>Once you're done with all the setup</strong>, you should remove the admin bit from <code>kojiadmin</code>, block the user, and remove its password from the database.</p>
<div class="codehilite"><pre><span></span><span class="gp">[you@koji-hub]$</span> koji revoke-permission admin kojiadmin
<span class="gp">[you@koji-hub]$</span> koji disable-user kojiadmin
</pre></div>


<p>In the database:</p>
<div class="codehilite"><pre><span></span><span class="gp">koji=&gt;</span>  <span class="k">update</span> <span class="n">users</span> <span class="k">set</span> <span class="k">password</span> <span class="o">=</span> <span class="k">null</span> <span class="k">where</span> <span class="k">name</span><span class="o">=</span><span class="s1">&#39;kojiadmin&#39;</span><span class="p">;</span>
</pre></div>


<h4 id="koji-filesystem">Koji filesystem<a class="headerlink" href="#koji-filesystem" title="Permanent link">&para;</a></h4>
<p><code>KojiDir</code> is <code>/mnt/koji</code>, so the following tree should be created:</p>
<div class="codehilite"><pre><span></span><span class="gp">[root@koji-hub]#</span> mkdir -p /mnt/koji/<span class="o">{</span>packages,repos,work,scratch<span class="o">}</span>
<span class="gp">[root@koji-hub]#</span> chown apache:apache *
</pre></div>


<h4 id="accounts-for-kojira-and-kojid">Accounts for kojira and kojid<a class="headerlink" href="#accounts-for-kojira-and-kojid" title="Permanent link">&para;</a></h4>
<hr />
<blockquote>
<p>It is important to note that the kojira component needs repo privileges, but if you just let the account get auto created the first time you run kojira, it won't have that privilege, so you should pre-create the account and grant it the repo privilege now.</p>
<div class="codehilite"><pre><span></span>kojiadmin@koji-hub$ koji add-user kojira
kojiadmin@koji-hub$ koji grant-permission repo kojira
</pre></div>


<p>For similar technical reasons, you need to add-host each build host prior to starting kojid on that host the first time and could also do that now.</p>
</blockquote>
<hr />
<p>We turned off auto account creation, so there won't be a problem with accounts with bad perms getting created. This means they have to be created manually. We have kojid running on koji-hub, so this is the command we used to add it:</p>
<div class="codehilite"><pre><span></span><span class="gp">[you@koji-hub]$</span> koji add-host koji-hub.batlab.org i386 x86_64
</pre></div>


<h3 id="koji-web-kojid">Koji-Web, Kojid<a class="headerlink" href="#koji-web-kojid" title="Permanent link">&para;</a></h3>
<p>Installing:</p>
<div class="codehilite"><pre><span></span><span class="gp">[root@koji-hub]#</span> yum install koji-web mod_ssl
<span class="gp">[root@koji-hub]#</span> yum install koji-builder
</pre></div>


<p>Note that we use a patched koji-builder, so be sure to install what's in the OSG repository. (The patch is not likely to be accepted upstream).</p>
<h4 id="ssl-certs">SSL certs<a class="headerlink" href="#ssl-certs" title="Permanent link">&para;</a></h4>
<p>The following files should be in the <code>/etc/pki/tls</code> tree:</p>
<ul>
<li>
<p><code>/etc/pki/tls/private/digicert_hostkey.key</code><br />
    the host key from DigiCert</p>
</li>
<li>
<p><code>/etc/pki/tls/private/kojiweb.pem</code><br />
    digicert_hostcert.crt catted together with digicert_hostkey.key (public key first)</p>
</li>
<li>
<p><code>/etc/pki/tls/private/kojira.key</code><br />
    kojira's private key from DigiCert</p>
</li>
<li>
<p><code>/etc/pki/tls/private/kojira.pem</code><br />
    kojira.crt catted together with kojira.key (public key first)</p>
</li>
<li>
<p><code>/etc/pki/tls/cert.pem</code><br />
    symlink to certs/ca-bundle.crt</p>
</li>
<li>
<p><code>/etc/pki/tls/certs/ca-bundle.crt</code><br />
    all certs available on the system; the DigiCert Grid certs should be in here</p>
</li>
<li>
<p><code>/etc/pki/tls/certs/kojira.crt</code><br />
    kojira's cert</p>
</li>
<li>
<p><code>/etc/pki/tls/certs/digicert_hostcert.crt</code><br />
    the host cert from DigiCert</p>
</li>
<li>
<p><code>/etc/pki/tls/certs/digicert-chain.crt</code><br />
    the DigiCert CAs catted together</p>
</li>
</ul>
<h4 id="adding-koji-builder-host-to-database">Adding koji-builder host to database<a class="headerlink" href="#adding-koji-builder-host-to-database" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="gp">[you@koji-hub]$</span> koji add-host-to-channel koji-hub.batlab.org createrepo
</pre></div>


<p>In the database:</p>
<div class="codehilite"><pre><span></span><span class="gp">koji=&gt;</span><span class="o">#</span>  <span class="k">update</span> <span class="n">host</span> <span class="k">set</span> <span class="n">capacity</span> <span class="o">=</span> <span class="mf">4</span> <span class="k">where</span> <span class="k">name</span> <span class="o">=</span> <span class="s1">&#39;koji-hub.batlab.org&#39;</span><span class="p">;</span>
</pre></div>


<h4 id="start-kojid">Start kojid<a class="headerlink" href="#start-kojid" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="gp">[root@koji-hub]#</span> /sbin/service kojid start
</pre></div>


<p>Check <code>/var/log/kojid.log</code> to make sure everything started up.</p>
<h3 id="kojira">Kojira<a class="headerlink" href="#kojira" title="Permanent link">&para;</a></h3>
<p>Installing:</p>
<div class="codehilite"><pre><span></span><span class="gp">[root@koji-hub]#</span> yum install koji-utils
</pre></div>


<p>Kojira also needs a user</p>
<div class="codehilite"><pre><span></span><span class="gp">[you@koji-hub]$</span> koji add-user kojira
<span class="gp">[you@koji-hub]$</span> koji grant-permission repo kojira
</pre></div>


<p>Start it up</p>
<div class="codehilite"><pre><span></span><span class="gp">[root@koji-hub]#</span> /sbin/service kojira start
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../documentation/new-doc-area/" title="Creating a New Area" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Creating a New Area
              </span>
            </div>
          </a>
        
        
          <a href="../../projects/sha2-support/" title="SHA-2 Support" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                SHA-2 Support
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.30f6b8b1.js"></script>
      
      <script>app.initialize({version:"0.17.5",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>